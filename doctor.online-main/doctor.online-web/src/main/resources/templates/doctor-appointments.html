<!DOCTYPE html>
<html lang="en" xmlns:th="https://thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{fragments/layout}">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async
	src="https://www.googletagmanager.com/gtag/js?id=UA-90680653-2"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-90680653-2');
    </script>

<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Meta -->
<meta name="description"
	content="Responsive Bootstrap 4 Dashboard Template">
<meta name="author" content="BootstrapDash">

<title>Appointments | Doctor Online</title>

<!-- vendor css -->
<link href="../lib/fontawesome-free/css/all.min.css" rel="stylesheet">
<link href="../lib/ionicons/css/ionicons.min.css" rel="stylesheet">
<link href="../lib/typicons.font/typicons.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

<!-- azia CSS -->
<link rel="stylesheet" href="../css/azia.css">

<style>
.navbar-brand {
	font-weight: 600;
}

.card {
	border: none;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.btn-outline-primary:hover {
	transform: translateY(-1px);
}

.appointment-card {
	transition: all 0.3s ease;
}

.appointment-card:hover {
	transform: translateY(-2px);
	box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
}

.prescription-form {
	background: #f8f9fa;
	border-radius: 10px;
}

.medication-item {
	background: white;
	border: 1px solid #e9ecef;
	border-radius: 8px;
}

.status-pending {
	color: #ffc107;
}

.status-scheduled {
	color: #198754;
}

.status-completed {
	color: #6c757d;
}

.nav-pills .nav-link.active {
	background-color: #0d6efd;
}

.form-control:focus, .form-select:focus {
	border-color: #86b7fe;
	box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.tab-navigation {
	background: white;
	padding: 15px;
	border-radius: 8px;
	margin-bottom: 20px;
}

.tab-navigation .nav-link {
	border-radius: 25px;
	margin-right: 10px;
}

.badge-count {
	font-size: 0.7em;
	margin-left: 5px;
}
</style>

</head>
<body>

	<div class="content-wrapper" layout:fragment="content">

		<div class="az-content pd-y-20 pd-lg-y-30 pd-xl-y-40">
			<div class="container">
				<div class="az-content-left az-content-left-components">
					<div class="component-item">
						<label>Appointments</label>
						<nav class="nav flex-column">
							<a href="#" class="nav-link active" data-tab="scheduled">Scheduled</a>
							<a href="#" class="nav-link" data-tab="confirmations">Confirmations</a>
							<a href="#" class="nav-link" data-tab="completed">Completed</a>
							<a href="#" class="nav-link" data-tab="expired">Expired</a>
						</nav>
					</div>
				</div>

				<div class="az-content-body pd-lg-l-40 d-flex flex-column">
					<div class="az-content-breadcrumb">
						<span>Appointments</span>
					</div>

					<!-- Tab Navigation -->
					<div class="tab-navigation">
						<ul class="nav nav-pills" id="appointmentTabs">
							<li class="nav-item">
								<a class="nav-link active" data-bs-toggle="pill" href="#scheduled">
									Scheduled <span class="badge bg-primary badge-count" id="scheduledCount">3</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" data-bs-toggle="pill" href="#confirmations">
									Confirmations <span class="badge bg-warning badge-count" id="confirmationsCount">5</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" data-bs-toggle="pill" href="#completed">
									Completed <span class="badge bg-success badge-count" id="completedCount">12</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" data-bs-toggle="pill" href="#expired">
									Expired <span class="badge bg-danger badge-count" id="expiredCount">2</span>
								</a>
							</li>
						</ul>
					</div>

					<div class="tab-content">
						<!-- Scheduled Appointments Tab -->
						<div class="tab-pane fade show active" id="scheduled">
							<div class="d-flex justify-content-between align-items-center mb-4">
								<h2 class="az-content-title">Today's Scheduled Appointments</h2>
							</div>
							<div class="row" id="scheduledAppointments">
								<!-- Scheduled appointments will be loaded here -->
							</div>
						</div>

						<!-- Confirmations Tab -->
						<div class="tab-pane fade" id="confirmations">
							<div class="d-flex justify-content-between align-items-center mb-4">
								<h2 class="az-content-title">Appointment Confirmations</h2>
							</div>
							
							<!-- Sub-tabs for Instant and Scheduled confirmations -->
							<ul class="nav nav-tabs mb-4" id="confirmationSubTabs">
								<li class="nav-item">
									<a class="nav-link active" data-bs-toggle="tab" href="#instantConfirmations">
										Instant Confirmations <span class="badge bg-info badge-count" id="instantCount">3</span>
									</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" data-bs-toggle="tab" href="#scheduledConfirmations">
										Scheduled Confirmations <span class="badge bg-warning badge-count" id="scheduledConfCount">2</span>
									</a>
								</li>
							</ul>
							
							<div class="tab-content">
								<div class="tab-pane fade show active" id="instantConfirmations">
									<div class="row" id="instantConfirmationsList">
										<!-- Instant confirmations will be loaded here -->
									</div>
								</div>
								<div class="tab-pane fade" id="scheduledConfirmations">
									<div class="row" id="scheduledConfirmationsList">
										<!-- Scheduled confirmations will be loaded here -->
									</div>
								</div>
							</div>
						</div>

						<!-- Completed Appointments Tab -->
						<div class="tab-pane fade" id="completed">
							<div class="d-flex justify-content-between align-items-center mb-4">
								<h2 class="az-content-title">Completed Appointments</h2>
								<div>
									<select class="form-select" id="completedFilter" onchange="filterCompleted()">
										<option value="all">All Time</option>
										<option value="today">Today</option>
										<option value="week">This Week</option>
										<option value="month">This Month</option>
									</select>
								</div>
							</div>
							<div class="row" id="completedAppointments">
								<!-- Completed appointments will be loaded here -->
							</div>
						</div>

						<!-- Expired Appointments Tab -->
						<div class="tab-pane fade" id="expired">
							<div class="d-flex justify-content-between align-items-center mb-4">
								<h2 class="az-content-title">Expired Appointments</h2>
							</div>
							<div class="row" id="expiredAppointments">
								<!-- Expired appointments will be loaded here -->
							</div>
						</div>
					</div>

					<div class="ht-40"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- Prescription Modal -->
	<div class="modal fade" id="prescriptionModal" tabindex="-1" aria-labelledby="prescriptionModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="prescriptionModalLabel">
						<i class="bi bi-prescription2 me-2"></i>Patient Prescription & Follow-up
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body prescription-form p-4">
					<!-- Patient Info Display -->
					<div class="row mb-4">
						<div class="col-12">
							<div class="card bg-white border">
								<div class="card-body">
									<div class="row">
										<div class="col-md-3">
											<strong>Patient:</strong> <span id="modalPatientName"></span>
										</div>
										<div class="col-md-2">
											<strong>Age:</strong> <span id="modalPatientAge"></span>
										</div>
										<div class="col-md-2">
											<strong>ID:</strong> <span id="modalPatientId"></span>
										</div>
										<div class="col-md-3">
											<strong>Appointment:</strong> <span id="modalAppointmentTime"></span>
										</div>
										<div class="col-md-2">
											<strong>Date:</strong> <span id="modalAppointmentDate"></span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Diagnosis & Symptoms -->
					<div class="row mb-4">
						<div class="col-md-6">
							<label class="form-label">Diagnosis <span class="text-danger">*</span></label>
							<textarea class="form-control" id="diagnosis" rows="3" placeholder="Enter primary diagnosis..." required></textarea>
						</div>
						<div class="col-md-6">
							<label class="form-label">Symptoms & Observations</label>
							<textarea class="form-control" id="symptoms" rows="3" placeholder="Patient symptoms and clinical observations..."></textarea>
						</div>
					</div>

					<!-- Medications -->
					<div class="mb-4">
						<div class="d-flex justify-content-between align-items-center mb-3">
							<label class="form-label mb-0">Medications</label>
							<button type="button" class="btn btn-outline-primary btn-sm" onclick="addMedication()">
								<i class="bi bi-plus-lg"></i> Add Medication
							</button>
						</div>
						<div id="medicationsList">
							<!-- Medications will be added here -->
						</div>
					</div>

					<!-- Visit Type & Follow-up -->
					<div class="row mb-4">
						<div class="col-md-4">
							<label class="form-label">Visit Type</label>
							<select class="form-select" id="visitType" onchange="toggleFollowup()">
								<option value="consultation">Routine Consultation</option>
								<option value="observation">Observation Required</option>
								<option value="hospital">Hospital Visit Required</option>
								<option value="followup">Follow-up Required</option>
							</select>
						</div>
						<div class="col-md-4" id="followupDateDiv" style="display: none;">
							<label class="form-label">Follow-up Date</label>
							<input type="date" class="form-control" id="followupDate">
						</div>
						<div class="col-md-4" id="priorityDiv" style="display: none;">
							<label class="form-label">Priority</label>
							<select class="form-select" id="priority">
								<option value="routine">Routine</option>
								<option value="urgent">Urgent</option>
								<option value="emergency">Emergency</option>
							</select>
						</div>
					</div>

					<!-- Additional Instructions -->
					<div class="row mb-4">
						<div class="col-md-6">
							<label class="form-label">General Instructions</label>
							<textarea class="form-control" id="generalInstructions" rows="3" placeholder="Diet, lifestyle, general care instructions..."></textarea>
						</div>
						<div class="col-md-6">
							<label class="form-label">Next Visit Instructions</label>
							<textarea class="form-control" id="nextVisitInstructions" rows="3" placeholder="Instructions for next visit or follow-up..."></textarea>
						</div>
					</div>

					<!-- Patient Notification -->
					<div class="row mb-4">
						<div class="col-12">
							<div class="card bg-info bg-opacity-10 border-info">
								<div class="card-body">
									<h6 class="card-title text-info">
										<i class="bi bi-bell me-2"></i>Patient Notification Settings
									</h6>
									<div class="form-check">
										<input class="form-check-input" type="checkbox" id="smsNotification" checked>
										<label class="form-check-label" for="smsNotification">
											Send SMS notification for follow-up appointment
										</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox" id="emailNotification" checked>
										<label class="form-check-label" for="emailNotification">
											Send email with prescription and instructions
										</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox" id="feedbackRequest">
										<label class="form-check-label" for="feedbackRequest">
											Request patient feedback after 24 hours
										</label>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="button" class="btn btn-outline-info" onclick="scheduleFollowup()">
						<i class="bi bi-calendar-plus me-2"></i>Schedule Follow-up
					</button>
					<button type="button" class="btn btn-outline-success" onclick="generatePrescription()">
						<i class="bi bi-printer me-2"></i>Generate PDF
					</button>
					<button type="button" class="btn btn-primary" onclick="savePrescription()">
						<i class="bi bi-check-lg me-2"></i>Save & Complete
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Success Modal -->
	<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="successModalLabel">
						<i class="bi bi-check-circle text-success me-2"></i>Success
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p id="successMessage"></p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Confirmation Modal -->
	<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmationModalLabel">Confirm Action</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p id="confirmationMessage"></p>
					<div id="rejectionReasonDiv" style="display: none;">
						<label class="form-label">Reason for rejection:</label>
						<textarea class="form-control" id="rejectionReason" rows="3" placeholder="Please provide a reason..."></textarea>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" id="confirmActionBtn">Confirm</button>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="../lib/jquery/jquery.min.js"></script>
	<script src="../lib/ionicons/ionicons.js"></script>
	<script src="../js/jquery.cookie.js" type="text/javascript"></script>
	<script src="../js/azia.js"></script>

	<script>
$(document).ready(function(){
	console.log("<<Appointment Management System>>");
	loadAppointments();
	
	// Tab switching
	$('.nav-link[data-bs-toggle="pill"]').on('shown.bs.tab', function (e) {
		const target = $(e.target).attr('href').substring(1);
		loadTabContent(target);
	});
});

let medicationCount = 0;
let currentAppointmentId = null;

// Sample data - replace with your backend API calls
const sampleData = {
	scheduled: [
		{
			id: 'APT001',
			patientId: 'P003',
			patientName: 'Michael Brown',
			age: 28,
			time: '9:00 AM',
			date: '2025-08-04',
			reason: 'Regular checkup',
			status: 'scheduled'
		},
		{
			id: 'APT002',
			patientId: 'P004',
			patientName: 'Sarah Wilson',
			age: 55,
			time: '11:30 AM',
			date: '2025-08-04',
			reason: 'Diabetes follow-up',
			status: 'scheduled'
		},
		{
			id: 'APT003',
			patientId: 'P005',
			patientName: 'Robert Taylor',
			age: 62,
			time: '3:45 PM',
			date: '2025-08-04',
			reason: 'Hypertension review',
			status: 'scheduled'
		}
	],
	instantConfirmations: [
		{
			id: 'APT006',
			patientId: 'P008',
			patientName: 'Emma Davis',
			age: 34,
			time: '10:00 AM',
			date: '2025-08-04',
			reason: 'Urgent consultation',
			type: 'instant',
			status: 'pending'
		},
		{
			id: 'APT007',
			patientId: 'P009',
			patientName: 'James Wilson',
			age: 41,
			time: '2:30 PM',
			date: '2025-08-04',
			reason: 'Emergency checkup',
			type: 'instant',
			status: 'pending'
		}
	],
	scheduledConfirmations: [
		{
			id: 'APT008',
			patientId: 'P010',
			patientName: 'Lisa Anderson',
			age: 29,
			time: '9:30 AM',
			date: '2025-08-05',
			reason: 'Routine consultation',
			type: 'scheduled',
			status: 'pending'
		}
	],
	completed: [
		{
			id: 'APT004',
			patientId: 'P006',
			patientName: 'Jennifer Lee',
			age: 38,
			time: '10:00 AM',
			date: '2025-08-03',
			reason: 'Follow-up visit',
			status: 'completed',
			completedDate: '2025-08-03'
		}
	],
	expired: [
		{
			id: 'APT005',
			patientId: 'P007',
			patientName: 'David Kim',
			age: 45,
			time: '2:00 PM',
			date: '2025-08-01',
			reason: 'Missed appointment',
			status: 'expired'
		}
	]
};

// Load appointments based on active tab
function loadAppointments() {
	loadTabContent('scheduled');
}

function loadTabContent(tab) {
	switch(tab) {
		case 'scheduled':
			renderScheduledAppointments();
			break;
		case 'confirmations':
			renderConfirmations();
			break;
		case 'completed':
			renderCompletedAppointments();
			break;
		case 'expired':
			renderExpiredAppointments();
			break;
	}
}

function renderScheduledAppointments() {
	const container = document.getElementById('scheduledAppointments');
	container.innerHTML = '';
	
	sampleData.scheduled.forEach(appointment => {
		const appointmentHtml = `
			<div class="col-md-4 mb-3">
				<div class="card appointment-card border-success">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-start">
							<div>
								<h6 class="card-title mb-1">${appointment.patientName}</h6>
								<p class="text-muted small mb-2">Age: ${appointment.age} | ID: ${appointment.patientId}</p>
								<p class="text-success small mb-2">
									<i class="bi bi-clock me-1"></i>${appointment.time}
								</p>
								<p class="text-muted small mb-0">Reason: ${appointment.reason}</p>
							</div>
							<span class="badge bg-success">Scheduled</span>
						</div>
						<div class="mt-3">
							<button class="btn btn-primary btn-sm" onclick="startConsultation('${appointment.id}')">
								<i class="bi bi-play-fill"></i> Start
							</button>
						</div>
					</div>
				</div>
			</div>
		`;
		container.innerHTML += appointmentHtml;
	});
	
	updateCount('scheduledCount', sampleData.scheduled.length);
}

function renderConfirmations() {
	renderInstantConfirmations();
	renderScheduledConfirmations();
}

function renderInstantConfirmations() {
	const container = document.getElementById('instantConfirmationsList');
	container.innerHTML = '';
	
	sampleData.instantConfirmations.forEach(appointment => {
		const appointmentHtml = `
			<div class="col-md-6 mb-3">
				<div class="card appointment-card border-warning">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-start">
							<div>
								<h6 class="card-title mb-1">${appointment.patientName}</h6>
								<p class="text-muted small mb-2">Age: ${appointment.age} | ID: ${appointment.patientId}</p>
								<p class="text-warning small mb-2">
									<i class="bi bi-clock me-1"></i>${appointment.time} - ${appointment.date}
								</p>
								<p class="text-muted small mb-0">Reason: ${appointment.reason}</p>
								<span class="badge bg-danger small">INSTANT CONFIRMATION</span>
							</div>
							<span class="badge bg-warning">Pending</span>
						</div>
						<div class="mt-3">
							<button class="btn btn-success btn-sm me-2" onclick="approveAppointment('${appointment.id}')">
								<i class="bi bi-check-lg"></i> Approve
							</button>
							<button class="btn btn-outline-danger btn-sm" onclick="rejectAppointment('${appointment.id}')">
								<i class="bi bi-x-lg"></i> Reject
							</button>
						</div>
					</div>
				</div>
			</div>
		`;
		container.innerHTML += appointmentHtml;
	});
	
	updateCount('instantCount', sampleData.instantConfirmations.length);
}

function renderScheduledConfirmations() {
	const container = document.getElementById('scheduledConfirmationsList');
	container.innerHTML = '';
	
	sampleData.scheduledConfirmations.forEach(appointment => {
		const appointmentHtml = `
			<div class="col-md-6 mb-3">
				<div class="card appointment-card border-info">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-start">
							<div>
								<h6 class="card-title mb-1">${appointment.patientName}</h6>
								<p class="text-muted small mb-2">Age: ${appointment.age} | ID: ${appointment.patientId}</p>
								<p class="text-info small mb-2">
									<i class="bi bi-clock me-1"></i>${appointment.time} - ${appointment.date}
								</p>
								<p class="text-muted small mb-0">Reason: ${appointment.reason}</p>
								<span class="badge bg-info small">SCHEDULED CONFIRMATION</span>
							</div>
							<span class="badge bg-warning">Pending</span>
						</div>
						<div class="mt-3">
							<button class="btn btn-success btn-sm me-2" onclick="approveAppointment('${appointment.id}')">
								<i class="bi bi-check-lg"></i> Approve
							</button>
							<button class="btn btn-outline-danger btn-sm" onclick="rejectAppointment('${appointment.id}')">
								<i class="bi bi-x-lg"></i> Reject
							</button>
						</div>
					</div>
				</div>
			</div>
		`;
		container.innerHTML += appointmentHtml;
	});
	
	updateCount('scheduledConfCount', sampleData.scheduledConfirmations.length);
}

function renderCompletedAppointments() {
	const container = document.getElementById('completedAppointments');
	container.innerHTML = '';
	
	sampleData.completed.forEach(appointment => {
		const appointmentHtml = `
			<div class="col-md-4 mb-3">
				<div class="card appointment-card border-success">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-start">
							<div>
								<h6 class="card-title mb-1">${appointment.patientName}</h6>
								<p class="text-muted small mb-2">Age: ${appointment.age} | ID: ${appointment.patientId}</p>
								<p class="text-success small mb-2">
									<i class="bi bi-clock me-1"></i>${appointment.time} - ${appointment.date}
								</p>
								<p class="text-muted small mb-2">Reason: ${appointment.reason}</p>
								<p class="text-success small mb-0">
									<i class="bi bi-check-circle me-1"></i>Completed on ${appointment.completedDate}
								</p>
							</div>
							<span class="badge bg-success">Completed</span>
						</div>
						<div class="mt-3">
							<button class="btn btn-outline-primary btn-sm" onclick="viewPrescription('${appointment.id}')">
								<i class="bi bi-eye"></i> View Details
							</button>
						</div>
					</div>
				</div>
			</div>
		`;
		container.innerHTML += appointmentHtml;
	});
	
	updateCount('completedCount', sampleData.completed.length);
}

function renderExpiredAppointments() {
	const container = document.getElementById('expiredAppointments');
	container.innerHTML = '';
	
	sampleData.expired.forEach(appointment => {
		const appointmentHtml = `
			<div class="col-md-4 mb-3">
				<div class="card appointment-card border-danger">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-start">
							<div>
								<h6 class="card-title mb-1">${appointment.patientName}</h6>
								<p class="text-muted small mb-2">Age: ${appointment.age} | ID: ${appointment.patientId}</p>
								<p class="text-danger small mb-2">
									<i class="bi bi-clock me-1"></i>${appointment.time} - ${appointment.date}
								</p>
								<p class="text-muted small mb-0">Reason: ${appointment.reason}</p>
							</div>
							<span class="badge bg-danger">Expired</span>
						</div>
						<div class="mt-3">
							<button class="btn btn-outline-secondary btn-sm" onclick="rescheduleAppointment('${appointment.id}')">
								<i class="bi bi-arrow-clockwise"></i> Reschedule
							</button>
						</div>
					</div>
				</div>
			</div>
		`;
		container.innerHTML += appointmentHtml;
	});
	
	updateCount('expiredCount', sampleData.expired.length);
}

function updateCount(elementId, count) {
	document.getElementById(elementId).textContent = count;
}

// Appointment Management Functions
function startConsultation(appointmentId) {
	currentAppointmentId = appointmentId;
	const appointment = sampleData.scheduled.find(apt => apt.id === appointmentId);
	
	if (appointment) {
		// Populate modal with appointment data
		document.getElementById('modalPatientName').textContent = appointment.patientName;
		document.getElementById('modalPatientAge').textContent = appointment.age;
		document.getElementById('modalPatientId').textContent = appointment.patientId;
		document.getElementById('modalAppointmentTime').textContent = appointment.time;
		document.getElementById('modalAppointmentDate').textContent = appointment.date;
		
		// Clear form
		clearPrescriptionForm();
		
		// Show modal
		new bootstrap.Modal(document.getElementById('prescriptionModal')).show();
	}
}

function approveAppointment(appointmentId) {
	showConfirmation(
		`Are you sure you want to approve this appointment?`,
		() => {
			// API call to approve appointment
			callAPI('POST', `/api/appointments/${appointmentId}/approve`, {}, (response) => {
				showSuccess(`Appointment approved successfully. Patient has been notified via SMS and email.`);
				removeAppointmentFromConfirmations(appointmentId);
			});
		}
	);
}

function rejectAppointment(appointmentId) {
	showConfirmation(
		`Are you sure you want to reject this appointment?`,
		() => {
			const reason = document.getElementById('rejectionReason').value.trim();
			if (!reason) {
				alert('Please provide a reason for rejection.');
				return;
			}
			
			// API call to reject appointment
			callAPI('POST', `/api/appointments/${appointmentId}/reject`, {
				reason: reason
			}, (response) => {
				showSuccess(`Appointment rejected successfully. Patient has been notified with the reason.`);
				removeAppointmentFromConfirmations(appointmentId);
			});
		},
		true // Show rejection reason textarea
	);
}

function removeAppointmentFromConfirmations(appointmentId) {
	// Remove from instant confirmations
	sampleData.instantConfirmations = sampleData.instantConfirmations.filter(apt => apt.id !== appointmentId);
	// Remove from scheduled confirmations
	sampleData.scheduledConfirmations = sampleData.scheduledConfirmations.filter(apt => apt.id !== appointmentId);
	
	// Re-render confirmations
	renderConfirmations();
}

function viewPrescription(appointmentId) {
	// API call to get prescription details
	callAPI('GET', `/api/appointments/${appointmentId}/prescription`, {}, (response) => {
		// Show prescription details in a modal or navigate to details page
		console.log('Prescription details:', response);
		showSuccess('Prescription details would be displayed here.');
	});
}

function rescheduleAppointment(appointmentId) {
	showSuccess('Reschedule functionality would open a date/time picker here.');
}

// Prescription Form Functions
function addMedication() {
	medicationCount++;
	const medicationHtml = `
		<div class="medication-item p-3 mb-3" id="medication${medicationCount}">
			<div class="row">
				<div class="col-md-3">
					<label class="form-label">Medication Name <span class="text-danger">*</span></label>
					<input type="text" class="form-control" name="medicationName" placeholder="e.g., Amoxicillin" required>
				</div>
				<div class="col-md-2">
					<label class="form-label">Dosage <span class="text-danger">*</span></label>
					<input type="text" class="form-control" name="dosage" placeholder="e.g., 500mg" required>
				</div>
				<div class="col-md-2">
					<label class="form-label">Frequency <span class="text-danger">*</span></label>
					<select class="form-select" name="frequency" required>
						<option value="">Select...</option>
						<option value="once">Once daily</option>
						<option value="twice">Twice daily</option>
						<option value="thrice">Three times daily</option>
						<option value="four">Four times daily</option>
					</select>
				</div>
				<div class="col-md-2">
					<label class="form-label">Duration <span class="text-danger">*</span></label>
					<input type="text" class="form-control" name="duration" placeholder="e.g., 7 days" required>
				</div>
				<div class="col-md-2">
					<label class="form-label">Instructions</label>
					<select class="form-select" name="instructions">
						<option value="before">Before meals</option>
						<option value="after">After meals</option>
						<option value="with">With meals</option>
						<option value="empty">Empty stomach</option>
					</select>
				</div>
				<div class="col-md-1 d-flex align-items-end">
					<button type="button" class="btn btn-outline-danger btn-sm" onclick="removeMedication(${medicationCount})">
						<i class="bi bi-trash"></i>
					</button>
				</div>
			</div>
		</div>
	`;
	document.getElementById('medicationsList').insertAdjacentHTML('beforeend', medicationHtml);
}

function removeMedication(id) {
	document.getElementById(`medication${id}`).remove();
}

function toggleFollowup() {
	const visitType = document.getElementById('visitType').value;
	const followupDiv = document.getElementById('followupDateDiv');
	const priorityDiv = document.getElementById('priorityDiv');
	
	if (visitType === 'followup' || visitType === 'observation' || visitType === 'hospital') {
		followupDiv.style.display = 'block';
		if (visitType === 'hospital') {
			priorityDiv.style.display = 'block';
		} else {
			priorityDiv.style.display = 'none';
		}
		
		// Set default follow-up date (7 days from now)
		const followupDate = new Date();
		followupDate.setDate(followupDate.getDate() + 7);
		document.getElementById('followupDate').value = followupDate.toISOString().split('T')[0];
	} else {
		followupDiv.style.display = 'none';
		priorityDiv.style.display = 'none';
	}
}

function clearPrescriptionForm() {
	document.getElementById('diagnosis').value = '';
	document.getElementById('symptoms').value = '';
	document.getElementById('generalInstructions').value = '';
	document.getElementById('nextVisitInstructions').value = '';
	document.getElementById('medicationsList').innerHTML = '';
	document.getElementById('visitType').value = 'consultation';
	document.getElementById('smsNotification').checked = true;
	document.getElementById('emailNotification').checked = true;
	document.getElementById('feedbackRequest').checked = false;
	toggleFollowup();
	medicationCount = 0;
}

function savePrescription() {
	if (!validatePrescriptionForm()) {
		return;
	}
	
	const prescriptionData = collectPrescriptionData();
	
	// API call to save prescription
	callAPI('POST', `/api/appointments/${currentAppointmentId}/prescription`, prescriptionData, (response) => {
		showSuccess('Prescription saved successfully! Appointment moved to completed.');
		
		// Move appointment from scheduled to completed
		moveAppointmentToCompleted(currentAppointmentId);
		
		// Close modal
		bootstrap.Modal.getInstance(document.getElementById('prescriptionModal')).hide();
		
		// Refresh scheduled appointments
		renderScheduledAppointments();
	});
}

function generatePrescription() {
	if (!validatePrescriptionForm()) {
		return;
	}
	
	const prescriptionData = collectPrescriptionData();
	
	// API call to generate prescription PDF
	callAPI('POST', `/api/appointments/${currentAppointmentId}/prescription/generate-pdf`, prescriptionData, (response) => {
		showSuccess('Prescription PDF generated successfully. Document sent to printer and patient email.');
	});
}

function scheduleFollowup() {
	const followupDate = document.getElementById('followupDate').value;
	if (!followupDate) {
		alert('Please select a follow-up date.');
		return;
	}
	
	const followupData = {
		appointmentId: currentAppointmentId,
		followupDate: followupDate,
		priority: document.getElementById('priority').value || 'routine',
		visitType: document.getElementById('visitType').value
	};
	
	// API call to schedule follow-up
	callAPI('POST', `/api/appointments/schedule-followup`, followupData, (response) => {
		showSuccess(`Follow-up appointment scheduled for ${followupDate}. Patient will receive confirmation via SMS and email with automatic reminders.`);
	});
}

function validatePrescriptionForm() {
	const diagnosis = document.getElementById('diagnosis').value.trim();
	if (!diagnosis) {
		alert('Please enter a diagnosis.');
		document.getElementById('diagnosis').focus();
		return false;
	}
	
	// Check if at least one medication is added
	const medications = document.querySelectorAll('#medicationsList .medication-item');
	if (medications.length === 0) {
		alert('Please add at least one medication.');
		addMedication();
		return false;
	}
	
	// Validate each medication
	for (let med of medications) {
		const name = med.querySelector('input[name="medicationName"]').value.trim();
		const dosage = med.querySelector('input[name="dosage"]').value.trim();
		const frequency = med.querySelector('select[name="frequency"]').value;
		const duration = med.querySelector('input[name="duration"]').value.trim();
		
		if (!name || !dosage || !frequency || !duration) {
			alert('Please fill in all required medication fields.');
			return false;
		}
	}
	
	return true;
}

function collectPrescriptionData() {
	const medications = [];
	const medicationItems = document.querySelectorAll('#medicationsList .medication-item');
	
	medicationItems.forEach(item => {
		medications.push({
			name: item.querySelector('input[name="medicationName"]').value,
			dosage: item.querySelector('input[name="dosage"]').value,
			frequency: item.querySelector('select[name="frequency"]').value,
			duration: item.querySelector('input[name="duration"]').value,
			instructions: item.querySelector('select[name="instructions"]').value
		});
	});
	
	return {
		appointmentId: currentAppointmentId,
		diagnosis: document.getElementById('diagnosis').value,
		symptoms: document.getElementById('symptoms').value,
		medications: medications,
		visitType: document.getElementById('visitType').value,
		followupDate: document.getElementById('followupDate').value,
		priority: document.getElementById('priority').value,
		generalInstructions: document.getElementById('generalInstructions').value,
		nextVisitInstructions: document.getElementById('nextVisitInstructions').value,
		notifications: {
			sms: document.getElementById('smsNotification').checked,
			email: document.getElementById('emailNotification').checked,
			feedbackRequest: document.getElementById('feedbackRequest').checked
		},
		completedDate: new Date().toISOString().split('T')[0]
	};
}

function moveAppointmentToCompleted(appointmentId) {
	const appointment = sampleData.scheduled.find(apt => apt.id === appointmentId);
	if (appointment) {
		appointment.status = 'completed';
		appointment.completedDate = new Date().toISOString().split('T')[0];
		
		// Remove from scheduled
		sampleData.scheduled = sampleData.scheduled.filter(apt => apt.id !== appointmentId);
		
		// Add to completed
		sampleData.completed.push(appointment);
	}
}

function filterCompleted() {
	const filter = document.getElementById('completedFilter').value;
	// Implement filtering logic based on selected option
	renderCompletedAppointments();
}

// Utility Functions
function showSuccess(message) {
	document.getElementById('successMessage').textContent = message;
	new bootstrap.Modal(document.getElementById('successModal')).show();
}

function showConfirmation(message, onConfirm, showRejectionReason = false) {
	document.getElementById('confirmationMessage').textContent = message;
	const rejectionDiv = document.getElementById('rejectionReasonDiv');
	const confirmBtn = document.getElementById('confirmActionBtn');
	
	if (showRejectionReason) {
		rejectionDiv.style.display = 'block';
		document.getElementById('rejectionReason').value = '';
	} else {
		rejectionDiv.style.display = 'none';
	}
	
	confirmBtn.onclick = onConfirm;
	new bootstrap.Modal(document.getElementById('confirmationModal')).show();
}

// API Helper Function - Replace with your actual API implementation
function callAPI(method, endpoint, data, successCallback, errorCallback) {
	console.log(`API Call: ${method} ${endpoint}`, data);
	
	// Simulate API call with setTimeout
	setTimeout(() => {
		if (Math.random() > 0.1) { // 90% success rate for demo
			if (successCallback) {
				successCallback({ success: true, data: data });
			}
		} else {
			if (errorCallback) {
				errorCallback({ error: 'API call failed' });
			} else {
				alert('API call failed. Please try again.');
			}
		}
	}, 500);
	
	/* 
	// Replace the above simulation with actual API calls like this:
	$.ajax({
		url: endpoint,
		method: method,
		data: JSON.stringify(data),
		contentType: 'application/json',
		success: function(response) {
			if (successCallback) successCallback(response);
		},
		error: function(xhr, status, error) {
			if (errorCallback) {
				errorCallback({error: error, status: status});
			} else {
				alert('API call failed: ' + error);
			}
		}
	});
	*/
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
	// Set today's date for any date inputs
	const today = new Date().toISOString().split('T')[0];
	// Add any initialization code here
});

	</script>

	<th:block layout:fragment="script">
		<!-- Add any additional scripts here -->
	</th:block>
</body>
</html>